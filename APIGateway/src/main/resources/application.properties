spring.application.name=APIGateway
server.port=8080


spring.main.web-application-type=reactive

# ==================== CONFIGURACIÓN GLOBAL CORS ====================
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-origins=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-methods=GET,POST,PUT,DELETE,PATCH,OPTIONS
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-headers=*


# ==================== MS GESTION DE INFRAESTRUCTURA ====================
spring.cloud.gateway.routes[0].id=tarifas-service
spring.cloud.gateway.routes[0].uri=http://ms-gestiondeinfraestructura:8082
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/tarifas/**
spring.cloud.gateway.routes[0].filters[0]=RewritePath=/api/tarifas/(?<segment>.*), /api/tarifas/${segment}

spring.cloud.gateway.routes[1].id=contenedores-service
spring.cloud.gateway.routes[1].uri=http://ms-gestiondeinfraestructura:8082
spring.cloud.gateway.routes[1].predicates[0]=Path=/api/contenedores/**
spring.cloud.gateway.routes[1].filters[0]=RewritePath=/api/contenedores/(?<segment>.*), /api/contenedores/${segment}

spring.cloud.gateway.routes[2].id=depositos-service
spring.cloud.gateway.routes[2].uri=http://ms-gestiondeinfraestructura:8082
spring.cloud.gateway.routes[2].predicates[0]=Path=/api/depositos/**
spring.cloud.gateway.routes[2].filters[0]=RewritePath=/api/depositos/(?<segment>.*), /api/depositos/${segment}
# ==================== MS GESTION DE OPERACIONES ====================
spring.cloud.gateway.routes[3].id=solicitudes-service
spring.cloud.gateway.routes[3].uri=http://ms-gestiondeoperaciones:8083
spring.cloud.gateway.routes[3].predicates[0]=Path=/api/solicitudes-traslado/**
spring.cloud.gateway.routes[3].filters[0]=RewritePath=/api/solicitudes-traslado/(?<segment>.*), /api/solicitudes-traslado/${segment}

spring.cloud.gateway.routes[4].id=clientes-service
spring.cloud.gateway.routes[4].uri=http://ms-gestiondeoperaciones:8083
spring.cloud.gateway.routes[4].predicates[0]=Path=/api/clientes/**
spring.cloud.gateway.routes[4].filters[0]=RewritePath=/api/clientes/(?<segment>.*), /api/clientes/${segment}

spring.cloud.gateway.routes[5].id=rutas-service
spring.cloud.gateway.routes[5].uri=http://ms-gestiondeoperaciones:8083
spring.cloud.gateway.routes[5].predicates[0]=Path=/api/rutas/**
spring.cloud.gateway.routes[5].filters[0]=RewritePath=/api/rutas/(?<segment>.*), /api/rutas/${segment}

spring.cloud.gateway.routes[6].id=tramos-service
spring.cloud.gateway.routes[6].uri=http://ms-gestiondeoperaciones:8083
spring.cloud.gateway.routes[6].predicates[0]=Path=/api/tramos/**
spring.cloud.gateway.routes[6].filters[0]=RewritePath=/api/tramos/(?<segment>.*), /api/tramos/${segment}

spring.cloud.gateway.routes[7].id=rutas-tentativas-service
spring.cloud.gateway.routes[7].uri=http://ms-gestiondeoperaciones:8083
spring.cloud.gateway.routes[7].predicates[0]=Path=/api/rutas-tentativas/**
spring.cloud.gateway.routes[7].filters[0]=RewritePath=/api/rutas-tentativas/(?<segment>.*), /api/rutas-tentativas/${segment}

spring.cloud.gateway.routes[8].id=contenedores-pendientes-service
spring.cloud.gateway.routes[8].uri=http://ms-gestiondeoperaciones:8083
spring.cloud.gateway.routes[8].predicates[0]=Path=/api/contenedores-pendientes/**
spring.cloud.gateway.routes[8].filters[0]=RewritePath=/api/contenedores-pendientes/(?<segment>.*), /api/contenedores-pendientes/${segment}

spring.cloud.gateway.routes[9].id=asignacion-camiones-service
spring.cloud.gateway.routes[9].uri=http://ms-gestiondeoperaciones:8083
spring.cloud.gateway.routes[9].predicates[0]=Path=/api/asignacion-camiones/**
spring.cloud.gateway.routes[9].filters[0]=RewritePath=/api/asignacion-camiones/(?<segment>.*), /api/asignacion-camiones/${segment}

spring.cloud.gateway.routes[10].id=contenedores-service
spring.cloud.gateway.routes[10].uri=http://ms-gestiondeoperaciones:8083
spring.cloud.gateway.routes[10].predicates[0]=Path=/api/contenedores/**
spring.cloud.gateway.routes[10].filters[0]=RewritePath=/api/contenedores/(?<segment>.*), /api/contenedores/${segment}

spring.cloud.gateway.routes[11].id=registro-tramos-service
spring.cloud.gateway.routes[11].uri=http://ms-gestiondeoperaciones:8083
spring.cloud.gateway.routes[11].predicates[0]=Path=/api/registro-tramos/**
spring.cloud.gateway.routes[11].filters[0]=RewritePath=/api/registro-tramos/(?<segment>.*), /api/registro-tramos/${segment}

# ==================== MS GESTION DE TRANSPORTE ====================
# Ruta para camiones
spring.cloud.gateway.routes[12].id=camiones-service
spring.cloud.gateway.routes[12].uri=http://ms-gestiondetransporte:8084
spring.cloud.gateway.routes[12].predicates[0]=Path=/api/camiones/**
spring.cloud.gateway.routes[12].filters[0]=RewritePath=/api/camiones/(?<segment>.*), /api/camiones/${segment}

# Ruta para transportistas
spring.cloud.gateway.routes[13].id=transportistas-service
spring.cloud.gateway.routes[13].uri=http://ms-gestiondetransporte:8084
spring.cloud.gateway.routes[13].predicates[0]=Path=/api/transportistas/**
spring.cloud.gateway.routes[13].filters[0]=RewritePath=/api/transportistas/(?<segment>.*), /api/transportistas/${segment}

spring.cloud.gateway.routes[14].id=tipos-camion-service
spring.cloud.gateway.routes[14].uri=http://ms-gestiondetransporte:8084
spring.cloud.gateway.routes[14].predicates[0]=Path=/api/tipos-camion/**
spring.cloud.gateway.routes[14].filters[0]=RewritePath=/api/tipos-camion/(?<segment>.*), /api/tipos-camion/${segment}

spring.cloud.gateway.routes[15].id=transporte-service
spring.cloud.gateway.routes[15].uri=http://ms-gestiondetransporte:8084
spring.cloud.gateway.routes[15].predicates[0]=Path=/api/transportes/**,/api/camiones/**,/api/conductores/**
spring.cloud.gateway.routes[15].filters[0]=RewritePath=/api/(?<segment>.*), /api/${segment}

# ==================== ACTUATOR ====================
management.endpoints.web.exposure.include=health,info,gateway
management.endpoint.health.show-details=always

# ==================== LOGGING ====================
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.reactor.netty=INFO

# ==================== SECURITY / OAUTH2 ====================

# Filtros por defecto del Gateway
# Evita que cookies del navegador se reenvíen a los microservicios, para mayor seguridad.
spring.cloud.gateway.default-filters[0]=RemoveRequestHeader=Cookie
#Hace que el API Gateway reenvíe automáticamente el token Bearer que recibió del cliente hacia los microservicios (así ellos pueden validarlo con Keycloak).
spring.cloud.gateway.default-filters[1]=TokenRelay

# Configuración del proveedor Keycloak
# Le dice al Gateway de dónde obtener los metadatos del servidor Keycloak (realm tpi-backend).
spring.security.oauth2.client.provider.keycloak.issuer-uri=http://keycloak:8080/realms/tpi-backend

# client-id y client-secret
# Deben coincidir con los del Client configurado en Keycloak.
spring.security.oauth2.client.registration.keycloak.client-id=tpi-backend-client
spring.security.oauth2.client.registration.keycloak.client-secret=tu_client_secret_si_tiene

spring.security.oauth2.client.registration.keycloak.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.keycloak.redirect-uri={baseUrl}/login/oauth2/code/keycloak
